<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Fabric</title>
  <style>
    .console {
      height: 300px;
      overflow: auto;
    }
  </style>
  <script src="https://unpkg.com/fabric@5.3.0/dist/fabric.min.js"></script>
  <script>
    function createLogger(selector) {
      const con = document.querySelector(selector);

      const info = (message) => {
        con.innerText = new Date().toLocaleTimeString() + " " + message + "\n" + con.innerText;
      };

      return {
        info,
      };
    }
  </script>
</head>
<body>
<div class="block">
  <h2>Pinch Zoom</h2>
  <canvas id="c1" width="600" height="400"></canvas>
  <div id="c1-console" class="console"></div>
  <script>
    (function(){
      const logger1 = createLogger("#c1-console");
      const canvas = new fabric.Canvas('c1');

      canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 }));

      canvas.selectionColor = 'rgba(0,255,0,0.3)';
      canvas.selectionBorderColor = 'red';
      canvas.selectionLineWidth = 5;
      canvas.backgroundColor = '#e0e0e0';
      canvas.renderAll();

      var pausePanning, currentX, currentY, xChange, yChange, lastX, lastY, zoomStartScale;

      canvas.on({
        'touch:gesture': function(e) {
          logger1.info('touch:gesture');
          if (e.e.touches && e.e.touches.length == 2) {
            pausePanning = true;
            var point = new fabric.Point(e.self.x, e.self.y);
            if (e.self.state == "start") {
              zoomStartScale = canvas.getZoom();
            }
            var delta = zoomStartScale * e.self.scale;
            canvas.zoomToPoint(point, delta);
            pausePanning = false;
          }
        },
        'object:selected': function() {
          logger1.info('object:selected');
          pausePanning = true;
        },
        'selection:cleared': function() {
          logger1.info('selection:cleared');
          pausePanning = false;
        },
        'touch:drag': function(e) {
          logger1.info('touch:drag');
          if (pausePanning == false && undefined != e.e.layerX && undefined != e.e.layerY) {
            currentX = e.e.layerX;
            currentY = e.e.layerY;
            xChange = currentX - lastX;
            yChange = currentY - lastY;

            if( (Math.abs(currentX - lastX) <= 50) && (Math.abs(currentY - lastY) <= 50)) {
              var delta = new fabric.Point(xChange, yChange);
              canvas.relativePan(delta);
            }

            lastX = e.e.layerX;
            lastY = e.e.layerY;
          }
        }
      });

    })();
  </script>
</div>
</body>
</html>
